{% extends "layout.html" %}
{% block content %}

<style>
    .dashboard-header {
        background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
        color: white;
        padding: 2rem;
        border-radius: 12px;
        margin-bottom: 2rem;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }


    .order-card {
        border: none;
        border-radius: 12px;
        background: #fff;
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        overflow: hidden;
    }
    
    .order-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.12);
    }

    .card-header-custom {
        background-color: #f8f9fa;
        border-bottom: 1px solid #eee;
        padding: 1rem 1.5rem;
    }

    .icon-muted { color: #adb5bd; }
    
    .status-border {
        border-left: 6px solid transparent;
    }
    .status-Shipped { border-left-color: #198754; }
    .status-Cancelled { border-left-color: #dc3545; }
    .status-On-Hold { border-left-color: #ffc107; }
    .status-In-Process { border-left-color: #0dcaf0; }
    .status-Resolved { border-left-color: #0d6efd; }

    .filter-btn {
        background: transparent;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 8px 15px;
        color: #555;
        transition: all 0.3s;
    }
    .filter-btn:hover, .filter-btn[aria-expanded="true"] {
        background: #f8f9fa;
        color: #0d6efd;
        border-color: #0d6efd;
    }
    .filter-dropdown {
        background: #fff;
        border: 1px solid #eee;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        padding: 20px;
        margin-top: 10px;
    }
    .filter-section-title {
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: #888;
        font-weight: 700;
        margin-bottom: 10px;
        border-bottom: 1px solid #eee;
        padding-bottom: 5px;
    }
    .form-check-input:checked {
        background-color: #0d6efd;
        border-color: #0d6efd;
    }
</style>

<div class="container mt-4 mb-5">

    <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="h4 mb-0">
        <i class="bi bi-box-seam me-2"></i>My Orders
    </h2>
    
    <button class="filter-btn d-flex align-items-center" type="button" data-bs-toggle="collapse" data-bs-target="#filterPanel" aria-expanded="false">
    <img src="{{ url_for('static', filename='images/filter.png') }}" 
         alt="Filter" 
         style="width: 20px; height: 20px; margin-right: 8px;">Filter Orders
    </button>

</div>

<div class="collapse mb-4" id="filterPanel">
    <div class="filter-dropdown">
        <form action="{{ url_for('customer_orders') }}" method="GET">
            <div class="row g-4">
                
                <div class="col-md-3">
                    <div class="filter-section-title">By Category</div>
                    <div style="max-height: 150px; overflow-y: auto;">
                        {% for line in product_lines %}
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="category" 
                                   value="{{ line.productLine }}" id="cat_{{ loop.index }}"
                                   {% if line.productLine in current_filters.categories %}checked{% endif %}>
                            <label class="form-check-label small" for="cat_{{ loop.index }}">
                                {{ line.productLine }}
                            </label>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="filter-section-title">By Price</div>
                    {% set ranges = ['0-1000', '1000-10000', '10000-50000', '50000-100000', '100000+'] %}
                    {% for rng in ranges %}
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="price" 
                               value="{{ rng }}" id="price_{{ loop.index }}"
                               {% if rng in current_filters.price_ranges %}checked{% endif %}>
                        <label class="form-check-label small" for="price_{{ loop.index }}">
                            $ {{ rng }}
                        </label>
                    </div>
                    {% endfor %}
                </div>

                <div class="col-md-3">
                    <div class="filter-section-title">By Status</div>
                    {% set statuses = ['In Process', 'Shipped', 'Cancelled', 'Resolved', 'Disputed', 'On Hold'] %}
                    {% for stat in statuses %}
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="status" 
                               value="{{ stat }}" id="stat_{{ loop.index }}"
                               {% if stat in current_filters.status %}checked{% endif %}>
                        <label class="form-check-label small" for="stat_{{ loop.index }}">
                            {{ stat }}
                        </label>
                    </div>
                    {% endfor %}
                </div>

                <div class="col-md-3">
                    <div class="filter-section-title">By Date</div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="sort_date" 
                               value="newest" id="sort_new"
                               {% if current_filters.sort_date == 'newest' %}checked{% endif %}>
                        <label class="form-check-label small" for="sort_new">
                            Newest First <i class="bi bi-arrow-down"></i>
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="sort_date" 
                               value="oldest" id="sort_old"
                               {% if current_filters.sort_date == 'oldest' %}checked{% endif %}>
                        <label class="form-check-label small" for="sort_old">
                            Oldest First <i class="bi bi-arrow-up"></i>
                        </label>
                    </div>
                    
                    <div class="mt-3 pt-3 border-top">
                        <button type="submit" class="btn btn-primary btn-sm w-100">
                            Apply Filters
                        </button>
                        <a href="{{ url_for('customer_orders') }}" class="btn btn-link btn-sm w-100 text-muted mt-1" style="text-decoration: none;">
                            Clear All
                        </a>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

    {% if orders %}
    <div class="row g-4"> {% for order in orders %}
        <div class="col-12">
            
            <a href="{{ url_for('order_detail', order_number=order.orderNumber) }}" class="text-decoration-none text-dark">
                <div class="card order-card shadow-sm status-{{ order.status | replace(' ', '-') }} status-border">
                    
                    <div class="card-header-custom d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <div class="bg-white p-2 rounded-circle shadow-sm me-3 text-primary">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-box-seam" viewBox="0 0 16 16">
                                  <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5l2.404.961L10.404 2l-2.218-.887zm3.564 1.426L5.596 5 8 5.961 14.154 3.5l-2.404-.961zm3.25 1.7-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923l6.5 2.6zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-1.187 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464L7.443.184z"/>
                                </svg>
                            </div>
                            <div>
                                <h6 class="mb-0 fw-bold text-uppercase small text-muted">Order Number</h6>
                                <span class="fs-5 fw-bold font-monospace">#{{ order.orderNumber }}</span>
                            </div>
                        </div>
                        
                        <div class="text-end">
                            <small class="text-muted d-block">Order Date</small>
                            <span class="fw-semibold">
                                <i class="bi bi-calendar3 me-1"></i> {{ order.orderDate.strftime('%d %b, %Y') }}
                            </span>
                        </div>
                    </div>

                    <div class="card-body p-4">
                        <div class="row align-items-center">
                            <div class="col-md-6 mb-3 mb-md-0">
                                <span class="text-muted small">Status:</span>
                                <div class="mt-1">
                                    {% if order.status == 'Shipped' %}
                                        <span class="badge rounded-pill bg-success px-3 py-2">
                                            ‚úÖ Shipped
                                        </span>
                                        {% if order.shippedDate %}
                                            <small class="text-success ms-2 fw-bold">on {{ order.shippedDate.strftime('%d %b') }}</small>
                                        {% endif %}
                                    
                                    {% elif order.status == 'Cancelled' %}
                                        <span class="badge rounded-pill bg-danger px-3 py-2">üö´ Cancelled</span>
                                    
                                    {% elif order.status == 'In Process' %}
                                        <span class="badge rounded-pill bg-info text-dark px-3 py-2">‚è≥ In Process</span>
                                    
                                    {% elif order.status == 'On Hold' %}
                                        <span class="badge rounded-pill bg-warning text-dark px-3 py-2">‚úã On Hold</span>
                                    
                                    {% else %}
                                        <span class="badge rounded-pill bg-secondary px-3 py-2">{{ order.status }}</span>
                                    {% endif %}
                                </div>
                            </div>

                            <div class="col-md-4 mb-3 mb-md-0">
                                {% if order.comments %}
                                    <div class="d-flex text-muted small fst-italic bg-light p-2 rounded">
                                        <div class="me-2">üí¨</div>
                                        <div class="text-truncate">{{ order.comments }}</div>
                                    </div>
                                {% endif %}
                            </div>

                            <div class="col-md-2 text-md-end">
                                <span class="btn btn-outline-primary btn-sm rounded-pill px-3">
                                    Details &rarr;
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>

    {% else %}
    <div class="card border-0 shadow-sm text-center py-5">
        <div class="card-body">
            <div class="mb-3 text-secondary" style="font-size: 4rem; opacity: 0.2;">üõí</div>
            <h3 class="text-muted fw-bold">No orders yet</h3>
            <p class="text-secondary mb-4">It looks like you haven't made any purchases.</p>
            <a href="{{ url_for('productlines') }}" class="btn btn-primary btn-lg rounded-pill px-5 shadow">
                Start Shopping
            </a>
        </div>
    </div>
    {% endif %}
</div>

{% if total_pages > 1 %}
<nav aria-label="Order navigation" class="mt-5">
    <ul class="pagination justify-content-center">
        
        <li class="page-item {% if page == 1 %}disabled{% endif %}">
            <a class="page-link border-0 shadow-sm rounded-circle mx-1" 
               href="{{ url_for(request.endpoint, page=page-1, **clean_args) }}" 
               aria-label="Previous" style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                <span aria-hidden="true">&laquo;</span>
            </a>
        </li>

        {% for p in range(1, total_pages + 1) %}
        <li class="page-item {% if p == page %}active{% endif %}">
            <a class="page-link border-0 shadow-sm rounded-circle mx-1" 
               href="{{ url_for(request.endpoint, page=p, **clean_args) }}"
               style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
               {{ p }}
            </a>
        </li>
        {% endfor %}

        <li class="page-item {% if page == total_pages %}disabled{% endif %}">
            <a class="page-link border-0 shadow-sm rounded-circle mx-1" 
               href="{{ url_for(request.endpoint, page=page+1, **clean_args) }}" 
               aria-label="Next" style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                <span aria-hidden="true">&raquo;</span>
            </a>
        </li>
    </ul>
    
    <div class="text-center text-muted small mt-2">
        Showing page {{ page }} of {{ total_pages }} (Total {{ total_orders }} orders)
    </div>
</nav>
{% endif %}

{% endblock %}