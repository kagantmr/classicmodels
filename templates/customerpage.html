{% extends "layout.html" %}
{% block content %}

<style>
  body {
    background-color: #1a1e2b;
    color: #e0e0e0;
  }

  h2, h3, h5, h6 {
    color: #ffffff;
    font-weight: 700;
  }

  /* Cards */
  .card-dark {
    background-color: #252a37;
    border-radius: 16px;
    border: none;
    box-shadow: 0 6px 18px rgba(0,0,0,0.35);
  }

  .card-static {
    transition: none !important;
  }

  .card-dark p,
  .card-dark strong,
  .card-dark address {
    color: #cfd6dd;
  }

  /* Card headers */
  .card-header-dark {
    background-color: #2c3140;
    border-bottom: 1px solid #343a4d;
    color: #ffffff;
    font-weight: 600;
    padding: 1rem 1.5rem;
  }

  /* Profile cards */
  .card.shadow-sm {
    background-color: #252a37;
    border: none;
    border-radius: 16px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.35);
  }

  .card.shadow-sm .card-header {
    background-color: #2c3140;
    color: #ffffff;
    border-bottom: 1px solid #343a4d;
  }

  /* Financial summary */
  .card.p-3 {
    background-color: #252a37;
    border-radius: 16px;
    border: none;
    box-shadow: 0 6px 18px rgba(0,0,0,0.35);
  }

  /* Badges */
  .badge.bg-danger {
    background-color: rgba(231, 76, 60, 0.2) !important;
    color: #e74c3c;
    border: 1px solid #e74c3c;
  }

  .badge.bg-success {
    background-color: rgba(46, 204, 113, 0.2) !important;
    color: #2ecc71;
    border: 1px solid #2ecc71;
  }

  /* Buttons */
  .btn-success {
    background-color: #2ecc71;
    border: none;
    font-weight: 600;
  }

  .btn-success:hover {
    background-color: #27ae60;
  }

  /* Table */
  .table-dark-custom {
    background-color: #252a37;
    color: #e0e0e0;
  }

  .table-dark-custom thead th {
    background-color: #2c3140;
    color: #adb5bd;
    text-transform: uppercase;
    font-size: 0.75rem;
    letter-spacing: 1px;
    border-bottom: 1px solid #343a4d;
  }

  .table-dark-custom tbody tr {
    border-bottom: 1px solid #343a4d;
  }

  .table-dark-custom tbody tr:hover {
    background-color: rgba(255,255,255,0.03);
  }

  .table-dark-custom td {
    border-top: none;
    color: #d0d6dc;
  }

  /* Alerts */
  .alert-warning {
    background-color: rgba(241, 196, 15, 0.15);
    color: #f1c40f;
    border: 1px solid #f1c40f;
  }
</style>


<!-- This page is for the logged-in customer to see their own info -->

{% if customer %}
    <!-- Customer Details Card -->
    <h2 class="mb-3">My Profile</h2>
    <div class="card shadow-sm mb-4 card-dark">
        <div class="card-header">
            <h5 class="mb-0">Welcome, {{ customer.contactFirstName }} {{ customer.contactLastName }}!</h5>
        </div>
        <div class="card-body">
            <h6 class="card-title"><strong>Company:</strong> {{ customer.customerName }}</h6>
            <div class="row">
                <div class="col-md-6">
                    <strong>Address:</strong>
                    <address class="ms-3">
                        {{ customer.addressLine1 }}<br>
                        {% if customer.addressLine2 %}
                            {{ customer.addressLine2 }}<br>
                        {% endif %}
                        {{ customer.city }}, {{ customer.state }} {{ customer.postalCode }}<br>
                        {{ customer.country }}
                    </address>
                </div>
                <div class="col-md-6">
                    <strong>Phone:</strong>
                    <p class="ms-3">{{ customer.phone }}</p>
                    
                    <strong>Credit Limit:</strong>
                    {% if customer.creditLimit %}
                        <p class="ms-3">${{ "{:,.2f}".format(customer.creditLimit) }}</p>
                    {% else %}
                        <p class="ms-3">${{ "{:,.2f}".format(0.0) }}</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

        <h3>Financial Summary</h3>
    <div class="card p-3 mb-4 card-dark">
    <p><strong>Total Orders:</strong> ${{ "{:,.2f}".format(balance.total_orders) }}</p>
    <p><strong>Total Payments:</strong> ${{ "{:,.2f}".format(balance.total_payments) }}</p>

    <strong>Balance:</strong>
    {% if balance.balance > 0 %}
        <span class="badge bg-danger">${{ "{:,.2f}".format(balance.balance) }} owed</span>
    {% else %}
        <span class="badge bg-success">No debt </span>
    {% endif %}
    </div>

<div class="mt-5 pt-4">
    <div class="payment-card-tech" style="border-radius: 16px; overflow: hidden; box-shadow: 0 6px 18px rgba(0,0,0,0.35);">
        <div class="card-header-payment p-3 d-flex justify-content-between align-items-center" 
             style="background: linear-gradient(135deg, #0e3a6d, #164f91); border-bottom: 1px solid #34495e;">
            <div>
                <h5 class="mb-0 text-white fw-bold"><i class="bi bi-wallet2 me-2"></i>Payment History</h5>
            </div>
            <a href="{{ url_for('make_payment') }}" 
               class="btn btn-light btn-sm fw-bold shadow-sm" style="color: #0e3a6d;">
                <i class="bi bi-plus-lg"></i> Record Payment
            </a>
        </div>
        
        <div class="table-responsive" style="background-color: #252a37;">
            <table class="table table-dark mb-0 align-middle" style="--bs-table-bg: transparent; --bs-table-color: #e0e0e0;">
                <thead style="background-color: #2c3140;">
                    <tr>
                        <th class="ps-4 py-3 text-secondary text-uppercase small">Date</th>
                        <th class="py-3 text-secondary text-uppercase small">Transaction ID</th>
                        <th class="text-end pe-4 py-3 text-secondary text-uppercase small">Amount</th>
                    </tr>
                </thead>
                <tbody style="border-top: 1px solid #34495e;">
                    {% if payments %}
                        {% for p in payments %}
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                            <td class="ps-4 text-white-50">{{ p.paymentDate }}</td>
                            <td class="text-white fw-bold font-monospace">{{ p.checkNumber }}</td>
                            <td class="text-end pe-4 text-success fw-bold">${{ "{:,.2f}".format(p.amount) }}</td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="3" class="text-center text-muted py-4">No payment history available.</td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>    </div>
</div>

{% else %}
    <div class="alert alert-warning">Could not load customer profile.</div>
{% endif %}

{% endblock %}