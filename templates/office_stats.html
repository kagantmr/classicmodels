{% extends "layout.html" %}

{% block content %}
<style>
:root{
    --bg:#0f1720;
    --panel:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));
    --muted:#9aa6b2;
    --accent:#60d394;
    --accent-2:#4dabf7;
    --card-border:rgba(255,255,255,0.04);
    --row-hover:rgba(255,255,255,0.02);
    --text:#e6eef6;
    --subtle:rgba(255,255,255,0.03);
}

.stats-wrapper{padding-top:2.25rem;padding-bottom:4rem}

.clean-card{
    background:var(--panel);
    border:1px solid var(--card-border);
    border-radius:14px;
    box-shadow:0 8px 30px rgba(3,6,12,.6);
    overflow:hidden;
    backdrop-filter:blur(6px)
}

.card-header-clean{
    background:linear-gradient(90deg,rgba(255,255,255,.01),rgba(255,255,255,.02));
    border-bottom:1px solid var(--subtle);
    padding:18px 22px;
    display:flex;
    justify-content:space-between;
    align-items:center
}

.card-body-clean{padding:22px;color:var(--text)}

.section-title{
    font-size:1.08rem;
    font-weight:700;
    color:var(--text);
    letter-spacing:.4px;
    font-family:'Playfair Display',serif
}

.table{
    background:rgba(255,255,255,.015);
    border-radius:12px;
    overflow:hidden
}

.table-header-clean th{
    background:rgba(255,255,255,.02);
    font-size:.7rem;
    text-transform:uppercase;
    letter-spacing:1.2px;
    color:#8fa3b8;
    font-weight:700;
    border-bottom:1px solid rgba(255,255,255,.06);
    padding:14px 12px
}

.table-row-clean td{
    background-color: #0e3a6d;
    padding:15px 12px;
    border-bottom:1px solid rgba(255,255,255,.035);
    color:var(--text);
    font-size:.92rem;
    transition:background .18s ease,box-shadow .18s ease,transform .18s ease
}

.table-row-clean:nth-child(even) td{
    background:rgba(255,255,255,.01)
}



.table-row-clean:last-child td{border-bottom:none}

.font-mono{
    font-family:'JetBrains Mono','SF Mono',Monaco,Consolas,monospace;
    letter-spacing:-.3px
}

.stat-money{color:var(--accent);font-weight:700}
.stat-date{color:var(--muted);font-size:.85rem}

.total-revenue-badge{text-align:right}
.total-label{
    font-size:.68rem;
    text-transform:uppercase;
    letter-spacing:1px;
    color:var(--muted);
    display:block;
    margin-bottom:4px
}

.total-value{
    font-size:1.45rem;
    font-weight:800;
    color:var(--text);
    font-family:'JetBrains Mono',monospace
}

.manager-name{font-weight:600;color:var(--text)}
.manager-na{color:#7b8791;font-style:italic;font-weight:500}

.territory-tag{
    background:linear-gradient(180deg,rgba(77,171,247,.15),rgba(77,171,247,.05));
    color:#a5c9ff;
    border:1px solid rgba(77,171,247,.25);
    border-radius:10px;
    font-size:.72rem;
    font-weight:700;
    padding:6px 0;
    width:86px;
    text-align:center;
    display:inline-block
}

.text-readable-muted{color:var(--muted)!important}

@media(max-width:768px){
    .section-title{font-size:1rem}
    .total-value{font-size:1.05rem}
}
</style>

<div class="stats-wrapper">
<div class="container-fluid px-4">

<div class="mb-4 pt-2">
<h2 class="h4 fw-bold text-white mb-1" style="font-family:'Playfair Display',serif">Office Analytics</h2>
<p class="text-readable-muted small mb-0">Performance metrics & workforce distribution</p>
</div>

<div class="row mb-5">
<div class="col-12">
<div class="clean-card">

<div class="card-header-clean">
<h5 class="section-title"><i class="bi bi-graph-up-arrow me-2 text-success"></i>Financial Performance</h5>
<div class="total-revenue-badge">
<span class="total-label">Total Revenue</span>
<span class="total-value">${{ "{:,.2f}".format(grand_total_sales) }}</span>
</div>
</div>

<div class="card-body-clean">
<div class="row align-items-center">

<div class="col-lg-7 border-end border-secondary pe-lg-4">
<div class="table-responsive">
<table class="table table-borderless align-middle mb-0">
<thead class="table-header-clean">
<tr>
<th class="ps-2">Location</th>
<th class="text-center">Total Orders</th>
<th class="text-end">Sales Volume</th>
<th class="text-end pe-2">Last Activity</th>
</tr>
</thead>
<tbody>
{% for stat in order_stats %}
<tr class="table-row-clean">
<td class="ps-2">
<div class="fw-bold text-white">{{ stat.city }}</div>
<div class="text-readable-muted small">{{ stat.country }}</div>
</td>
<td class="text-center font-mono fw-bold">{{ stat.total_orders }}</td>
<td class="text-end stat-money font-mono">${{ "{:,.2f}".format(stat.total_sales) }}</td>
<td class="text-end pe-2 stat-date font-mono">
{% if stat.last_activity %}
{{ stat.last_activity.strftime('%Y-%m-%d') }}
{% else %}
-
{% endif %}
</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>
</div>

<div class="col-lg-5 ps-lg-4 mt-4 mt-lg-0">
<h6 class="text-uppercase text-readable-muted fw-bold mb-4 small text-center" style="letter-spacing:1px">Distribution of Revenue</h6>
<div style="position:relative;height:300px">
<canvas id="salesPieChart"></canvas>
</div>
</div>

</div>
</div>

</div>
</div>
</div>

<div class="row">
<div class="col-12">
<div class="clean-card">

<div class="card-header-clean">
<h5 class="section-title"><i class="bi bi-people-fill me-2 text-info"></i>Workforce Overview</h5>
</div>

<div class="card-body-clean">
<div class="table-responsive">
<table class="table table-borderless align-middle mb-0">
<thead class="table-header-clean">
<tr>
<th class="ps-2">Office</th>
<th>Regional Manager</th>
<th class="text-center">Active Staff</th>
<th class="text-center">Client Base</th>
<th class="text-end pe-2">Territory</th>
</tr>
</thead>
<tbody>
{% for act in activity_stats %}
<tr class="table-row-clean">
<td class="ps-2 fw-bold text-white">{{ act.city }}</td>
<td>
{% if 'N/A' in act.managers or 'Lead' in act.managers %}
<span class="manager-na">{{ act.managers }}</span>
{% else %}
<span class="manager-name">{{ act.managers }}</span>
{% endif %}
</td>
<td class="text-center font-mono">{{ act.active_employees }}</td>
<td class="text-center">
<span class="fw-bold">{{ act.customer_count }}</span>
<span class="text-readable-muted small ms-1">clients</span>
</td>
<td class="text-end pe-2">
<span class="territory-tag">{{ act.territory }}</span>
</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>
</div>

</div>
</div>
</div>

</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener("DOMContentLoaded",function(){
const labels=[{% for item in order_stats %}"{{ item.city }}",{% endfor %}]
const data=[{% for item in order_stats %}{{ item.total_sales }},{% endfor %}]
const colors=['#4dabf7','#60d394','#b388ff','#ffd166','#ff6b6b','#2ec4b6','#ffa94d','#6b7280']
const ctx=document.getElementById('salesPieChart').getContext('2d')
new Chart(ctx,{
type:'doughnut',
data:{labels:labels,datasets:[{data:data,backgroundColor:colors,borderWidth:0,hoverOffset:10}]},
options:{
responsive:true,
maintainAspectRatio:false,
cutout:'70%',
plugins:{
legend:{
position:'right',
labels:{usePointStyle:true,boxWidth:8,padding:12,font:{size:11},color:'#9aa6b2'},
onClick:null
},
tooltip:{
backgroundColor:'rgba(10,14,20,.95)',
titleColor:'#fff',
bodyColor:'#9aa6b2',
borderColor:'rgba(255,255,255,.04)',
borderWidth:1,
padding:12,
callbacks:{
label:function(ctx){
return' $'+ctx.raw.toLocaleString(undefined,{minimumFractionDigits:2})
}
}
}
}
}
})
})
</script>
{% endblock %}
