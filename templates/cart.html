{% extends "layout.html" %}
{% block content %}
<style>
  body {
    background-color: #1a1e2b;
    color: #e0e0e0;
  }

  h2, h4 {
    color: #ffffff;
    font-weight: 700;
  }

  /* Alerts */
  .alert-info {
    background-color: rgba(52, 152, 219, 0.15);
    color: #5dade2;
    border: 1px solid #3498db;
  }

  /* Buttons */
  .btn-primary {
    background-color: #3498db;
    border: none;
    font-weight: 600;
  }

  .btn-primary:hover {
    background-color: #2980b9;
  }

  .btn-success {
    background-color: #2ecc71;
    border: none;
    font-weight: 600;
  }

  .btn-success:hover {
    background-color: #27ae60;
  }

  .btn-danger {
    background-color: #e74c3c;
    border: none;
    font-weight: 600;
  }

  .btn-danger:hover {
    background-color: #c0392b;
  }

  /* Table */
  .table-dark-custom {
    background-color: #252a37;
    color: #e0e0e0;
    border-radius: 14px;
    overflow: hidden;
    box-shadow: 0 6px 18px rgba(0,0,0,0.35);
  }

  .table-dark-custom thead {
    background-color: #2c3140;
  }

  .table-dark-custom th {
    color: #adb5bd;
    text-transform: uppercase;
    font-size: 0.75rem;
    letter-spacing: 1px;
    border-bottom: 1px solid #343a4d;
  }

  .table-dark-custom td {
    border-top: 1px solid #343a4d;
    color: #d0d6dc;
    vertical-align: middle;
  }

  .table-dark-custom tbody tr:hover {
    background-color: rgba(255,255,255,0.03);
  }

  /* Inputs */
  .form-control-sm {
    background-color: #252a37;
    border: 1px solid #34495e;
    color: #ffffff;
    border-radius: 8px;
  }

  .form-control-sm:focus {
    background-color: #252a37;
    border-color: #3498db;
    box-shadow: 0 0 0 0.15rem rgba(52,152,219,0.25);
  }

  /* Total section */
  #cart-total {
    color: #2ecc71;
    font-weight: 800;
  }
</style>


<div class="container mt-4">
  <h2>Your Cart</h2>

    {% if not cart %}
    <div class="alert alert-info mt-3">
        Your cart is empty.
    </div>
    <a href="{{ url_for('productlines') }}" class="btn btn-primary mt-3">
        See products
    </a>
    {% else %}
    <table class="table table-dark-custom mt-3">
      <thead>
        <tr>
          <th>Product</th>
          <th>Unit Price</th>
          <th>Quantity</th>
          <th>Subtotal</th>
          <th>Remove</th>
        </tr>
      </thead>
      <tbody>
        {% for item in cart.values() %}
          <tr>
            <td>{{ item.productName }}</td>
            <td>${{ "%.2f"|format(item.priceEach) }}</td>
            <td>
              <form action="{{ url_for('update_cart', product_code=item.productCode) }}" method="POST" class="d-flex auto-update-form">
                <input type="number" name="quantity" value="{{ item.quantity }}" min="1"
                       class="form-control form-control-sm quantity-input"
                       style="width: 70px;">
              </form>
            </td>
            <td class="item-subtotal" data-price="{{ item.priceEach }}">
              ${{ "%.2f"|format(item.priceEach * item.quantity) }}
            </td>
            <td>
              <form action="{{ url_for('remove_from_cart', product_code=item.productCode) }}" method="POST">
                <button type="submit" class="btn btn-sm btn-danger" style="background-color: #0e3a6d;">Remove</button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="text-end">
    <h4>Total: <span id="cart-total">${{ "%.2f"|format(total) }}</span></h4>
    <a href="{{ url_for('checkout') }}" class="btn btn-success btn-lg mt-3">
        Proceed to Checkout
    </a>
    </div>
  {% endif %}
</div>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const quantityInputs = document.querySelectorAll(".quantity-input");

  quantityInputs.forEach(input => {
    input.addEventListener("change", () => {
      if (input.value < 1) input.value = 1;
      updateSubtotal(input);
      updateTotal();
      input.closest("form").submit();
    });
  });

  function updateSubtotal(input) {
    const row = input.closest("tr");
    const price = parseFloat(row.querySelector(".item-subtotal").dataset.price);
    const qty = parseInt(input.value);
    const cell = row.querySelector(".item-subtotal");
    cell.textContent = "$" + (price * qty).toFixed(2);
  }

  function updateTotal() {
    let total = 0;
    document.querySelectorAll(".item-subtotal").forEach(cell => {
      total += parseFloat(cell.textContent.replace("$", ""));
    });
    document.getElementById("cart-total").textContent = "$" + total.toFixed(2);
  }
});
</script>
{% endblock %}